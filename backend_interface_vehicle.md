# Vehicle API Specification

This document outlines the API endpoints for managing vehicles within the system.

## Base URL

`/api/v1/vehicles`

## Authentication

All endpoints, unless otherwise specified, require authentication. Users must have appropriate roles (e.g., `SERVICE_ADMIN`, `SERVICE_USER`) to access certain endpoints. Authentication is handled via Spring Security and the `@AuthenticationPrincipal` annotation, using a Bearer token.

## Endpoints

### 1. Create Vehicle

-   **Endpoint:** `POST /api/v1/vehicles`
-   **Description:** Creates a new vehicle. The authenticated user (with `SERVICE_USER` role) will be set as the owner of the vehicle.
-   **Request Body:**
```json
{ 
  "name": "string",
  "vehiclePicture": "string", 
  "vin": "string", 
  "manufacturer": "string",
  "status": { "key1": "value1", "key2": "value2" }, 
  "modelName": "string", 
  "purchaseYear": "integer",
  "registrationPicture" :  "string", 
  "memo": "string" }
```
    -   `name`: The name of the vehicle. (Required, cannot be blank)
    -   `vehiclePicture`: URL or path to the vehicle's picture.
    -   `vin`: Vehicle Identification Number.
    -   `manufacturer`: The manufacturer of the vehicle. (Required, cannot be blank)
    -   `status`: A map of key-value pairs representing the vehicle's status.
    -   `modelName`: The model name of the vehicle. (Required, cannot be blank)
    -   `purchaseYear`: The year the vehicle was purchased. (Minimum 1800)
    -   `registrationPicture`: URL or path to the vehicle's registration picture.
    -   `memo`: Any additional notes or information about the vehicle.

-   **Request Headers:**
    -   `Authorization`: `Bearer <token>` (Required)
-   **Permissions:** `SERVICE_USER`
-   **Response Body (Success - 200 OK):**
```json
{ "vehicleKey": "{{generated uuid}}" }
```
    -   `vehicleKey`: The unique identifier (UUID) of the newly created vehicle.

-   **Response Body (Error - 400 Bad Request):**
```json 
{ 
  "timestamp": "2023-10-27T10:00:00Z" ,  
  "status": 400, 
  "error": "Bad Request", 
  "message": "Validation failed for object='createVehicleRequest' .  Error count: 3", 
  "path": "/api/v1/vehicles"
}
```
    - **Description**
        - `name`, `manufacturer`, `modelName` are required.
        - `purchaseYear` must be greater than or equal to 1800.
        - The `vehicleKey` is generated by the server.
        - `name`, `manufacturer`, `modelName` cannot be blank.

### 2. Get Vehicle by Key

-   **Endpoint:** `GET /api/v1/vehicles/{vehicleKey}`
-   **Description:** Retrieves a specific vehicle by its unique key. Any authenticated user can access this endpoint.
-   **Path Parameters:**
    -   `vehicleKey`: The UUID of the vehicle to retrieve.
-   **Request Headers:**
    -   `Authorization`: `Bearer <token>` (Required)
-   **Permissions:** Any authenticated user.
-   **Response Body (Success - 200 OK):**
```json
{ "vehicleKey": "{{uuid}}", "name": "string", "vehiclePicture": "string", "vin": "string", "manufacturer": "string", "status": { "key1": "value1", "key2": "value2" }, "modelName": "string", "purchaseYear": "integer", "registrationPicture" :  "string", "memo": "string", "ownerUserKey": "{{uuid}}" }
```
    -   `vehicleKey`: The unique identifier (UUID) of the vehicle.
    -   `name`: The name of the vehicle.
    -   `vehiclePicture`: URL or path to the vehicle's picture.
    -   `vin`: Vehicle Identification Number.
    -   `manufacturer`: The manufacturer of the vehicle.
    -   `status`: A map of key-value pairs representing the vehicle's status.
    -   `modelName`: The model name of the vehicle.
    -   `purchaseYear`: The year the vehicle was purchased.
    -   `registrationPicture`: URL or path to the vehicle's registration picture.
    -   `memo`: Any additional notes or information about the vehicle.
    -   `ownerUserKey`: The unique identifier (UUID) of the vehicle's owner.

-   **Response Body (Error - 404 Not Found):**
```json
{ "timestamp": "2023-10-27T10:00:00Z" ,  "status": 404, "error": "Not Found", "message": "Vehicle not found", "path": "/api/v1/vehicles/{{ vehicleKey} } "  }
```
### 3. Get Vehicles (Paginated and Filtered)

-   **Endpoint:** `GET /api/v1/vehicles`
-   **Description:** Retrieves a paginated list of vehicles, optionally filtered by various criteria. Both `SERVICE_ADMIN` and `SERVICE_USER` roles can access this endpoint.
-   **Query Parameters:**
    -   `page`: Page number (default: 0).
    -   `size`: Page size (default: 10).
    -   `vin`: Filter by Vehicle Identification Number (optional).
    -   `ownerUserKey`: Filter by the owner's user key (optional).
    -   `manufacturer`: Filter by manufacturer (optional).
    -   `modelName`: Filter by model name (optional).
    -   `vehicleKey`: Filter by vehicle key (optional).
    -   `minMileage`: Filter by minimum mileage (optional).
    -   `maxMileage`: Filter by maximum mileage (optional).
-   **Request Headers:**
    -   `Authorization`: `Bearer <token>` (Required)
-   **Permissions:** `SERVICE_ADMIN`, `SERVICE_USER`
-   **Response Body (Success - 200 OK):**
```json
{ "content": [ { "vehicleKey": "{{uuid}}", "name": "string", "vehiclePicture": "string", "vin": "string", "manufacturer": "string", "status": { "key1": "value1", "key2": "value2" }, "modelName": "string", "purchaseYear": "integer", "registrationPicture" :  "string", "memo": "string", "ownerUserKey": "{{uuid}}" } ], "pageable": { "sort": { "empty": true, "sorted": false, "unsorted": true }, "offset": 0, "pageNumber": 0, "pageSize": 10, "paged": true, "unpaged": false }, "last": true, "totalPages": 1, "totalElements": 1, "size": 10, "number": 0, "sort": { "empty": true, "sorted": false, "unsorted": true }, "first": true, "numberOfElements": 1, "empty": false }
```
    -   `content`: An array of vehicle objects.
    -   `pageable`: Pagination information.
    -   `last`: Indicates if it's the last page.
    -   `totalPages`: Total number of pages.
    -   `totalElements`: Total number of vehicles.
    -   `size`: Page size.
    -   `number`: Current page number.
    -   `first`: Indicates if it's the first page.
    -   `numberOfElements`: Number of elements in the current page.
    -   `empty`: Indicates if the page is empty.

### 4. Update Vehicle

-   **Endpoint:** `PUT /api/v1/vehicles/{vehicleKey}`
-   **Description:** Updates an existing vehicle's information. Only `SERVICE_ADMIN` and `SERVICE_USER` roles can access this endpoint.
-   **Path Parameters:**
    -   `vehicleKey`: The UUID of the vehicle to update.
-   **Request Body:**
```json
{ "name": "string", "vehiclePicture": "string", "modelName": "string", "registrationPicture" :  "string", "memo": "string" }
```
    -   `name`: The updated name of the vehicle.
    -   `vehiclePicture`: The updated URL or path to the vehicle's picture.
    -   `modelName`: The updated model name of the vehicle.
    -   `registrationPicture`: The updated URL or path to the vehicle's registration picture.
    -   `memo`: The updated memo for the vehicle.

-   **Request Headers:**
    -   `Authorization`: `Bearer <token>` (Required)
-   **Permissions:** `SERVICE_ADMIN`, `SERVICE_USER`
-   **Response Body (Success - 200 OK):**
```json
{ "vehicleKey": "{{uuid}}", "name": "string", "vehiclePicture": "string", "vin": "string", "manufacturer": "string", "status": { "key1": "value1", "key2": "value2" }, "modelName": "string", "purchaseYear": "integer", "registrationPicture" :  "string", "memo": "string", "ownerUserKey": "{{uuid}}" }
```
- **Response Body (Error - 400 Bad Request):**
```json
{ "timestamp": "2023-10-27T10:00:00Z" ,  "status": 400, "error": "Bad Request", "message": "Validation failed for object='updateVehicleRequest' .  Error count: 1", "path": "/api/v1/vehicles/{{ vehicleKey} } "  }
```

### 5. Update Vehicle Maintenance

-   **Endpoint:** `PATCH /api/v1/vehicles/{vehicleKey}/maintenance`
-   **Description:** Updates the maintenance information for a vehicle. Only `SERVICE_ADMIN` and `SERVICE_USER` roles can access this endpoint.
-   **Path Parameters:**
    -   `vehicleKey`: The UUID of the vehicle to update.
-   **Request Body:**
```json
{ "maintenanceType": "string",
  "changeDate": "yyyy-MM-dd", 
  "tirePosition": "FORE_LEFT or FORE_RIGHT or BACK_LEFT or BACK_RIGHT" 
}
```
    -   `maintenanceType`: The type of maintenance performed (e.g., "oil", "tire"). (Required, cannot be blank)
    -   `changeDate`: The date the maintenance was performed.
    -   `tirePosition`: The position of the tire if the `maintenanceType` is "tire". (Required if `maintenanceType` is "tire", can be `FORE_LEFT`, `FORE_RIGHT`, `BACK_LEFT`, or `BACK_RIGHT`)

-   **Request Headers:**
    -   `Authorization`: `Bearer <token>` (Required)
-   **Permissions:** `SERVICE_ADMIN`, `SERVICE_USER`
-   **Response Body (Success - 200 OK):**
```json
{ "result": "success" }
```
    -   `result`: A message indicating the success of the operation.

- **Response Body (Error - 400 Bad Request):**
```json
{ "timestamp": "2023-10-27T10:00:00Z" ,  "status": 400, "error": "Bad Request", "message": "Validation failed for object='maintenanceRequest' .  Error count: 1", "path": "/api/v1/vehicles/{{ vehicleKey} } / maintenance"  }
```
    - **Description**
        - `maintenanceType` is required.
        - if `maintenanceType` is `tire`, `tirePosition` is required.

### 6. Update Vehicle Mileage

-   **Endpoint:** `PATCH /api/v1/vehicles/{vehicleKey}/mileage`
-   **Description:** Updates the mileage of a vehicle. Only `SERVICE_ADMIN` and `SERVICE_USER` roles can access this endpoint.
-   **Path Parameters:**
    -   `vehicleKey`: The UUID of the vehicle to update.
-   **Request Body:**
```json
{ "mileage": "integer" }
```
    -   `mileage`: The updated mileage of the vehicle. (Required, must be positive or zero)

-   **Request Headers:**
    -   `Authorization`: `Bearer <token>` (Required)
-   **Permissions:** `SERVICE_ADMIN`, `SERVICE_USER`
-   **Response Body (Success - 200 OK):**
```json
{ "result": "success" }
```
    -   `result`: A message indicating the success of the operation.
- **Response Body (Error - 400 Bad Request):**
```json
{ "timestamp": "2023-10-27T10:00:00Z" ,  "status": 400, "error": "Bad Request", "message": "Validation failed for object='updateMileageRequest' .  Error count: 1", "path": "/api/v1/vehicles/{{ vehicleKey} } / mileage"  }
```
    - **Description**
        - `mileage` is required.
        - `mileage` must be positive or zero.

### 7. Delete Vehicle

-   **Endpoint:** `DELETE /api/v1/vehicles/{vehicleKey}`
-   **Description:** Deletes a vehicle. Any authenticated user can access this endpoint.
-   **Path Parameters:**
    -   `vehicleKey`: The UUID of the vehicle to delete.
-   **Request Headers:**
    -   `Authorization`: `Bearer <token>` (Required)
-   **Permissions:** Any authenticated user.
-   **Response Body (Success - 200 OK):**
```json
{ "result": "success" }
```
    -   `result`: A message indicating the success of the operation.

- **Response Body (Error - 404 Not Found):**
```json
{ "timestamp": "2023-10-27T10:00:00Z" ,  "status": 404, "error": "Not Found", "message": "Vehicle not found", "path": "/api/v1/vehicles/{{ vehicleKey} } "  }
```
## Data Types

-   `string`: A sequence of characters.
-   `integer`: A whole number.
-   `uuid`: A universally unique identifier.
-   `yyyy-MM-dd`: Date format.
-   `Map<String, String>`: A key-value pair data structure.
-   `FORE_LEFT`, `FORE_RIGHT`, `BACK_LEFT`, `BACK_RIGHT`: Enum for tire position.
-   `Bearer <token>` : Bearer token for authentication.
-   `SERVICE_ADMIN`, `SERVICE_USER`, `MAINTENANCE_ADMIN`: Enum for user type.
- `MALE`, `FEMALE`: Enum for user gender.



















